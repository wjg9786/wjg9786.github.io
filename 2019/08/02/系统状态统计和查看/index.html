<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=">


  <link rel="mask-icon" href="/images/logo.svg?v=" color="#222">





  <meta name="keywords" content="linux基础,">










<meta name="description" content="统计和查看linux的系统状态/proc的意义及说明在linux中查看各种状态，其实质是查看内核中相关进程的数据结构中的项，通过工具将其格式化后输出出来。但是内核的数据是绝对不能随意查看或更改的，至少不能直接去修改。所以在linux上出现了伪文件系统/proc，这是内核中各属性或状态向外提供访问或修改的接口。 在/proc下，记录了内核自己的数据信息，各进程独立的数据信息，统计信息等。绝大多数文件">
<meta name="keywords" content="linux基础">
<meta property="og:type" content="article">
<meta property="og:title" content="系统状态统计和查看">
<meta property="og:url" content="http://yunjis.cn/2019/08/02/系统状态统计和查看/index.html">
<meta property="og:site_name" content="莫欺少年穷">
<meta property="og:description" content="统计和查看linux的系统状态/proc的意义及说明在linux中查看各种状态，其实质是查看内核中相关进程的数据结构中的项，通过工具将其格式化后输出出来。但是内核的数据是绝对不能随意查看或更改的，至少不能直接去修改。所以在linux上出现了伪文件系统/proc，这是内核中各属性或状态向外提供访问或修改的接口。 在/proc下，记录了内核自己的数据信息，各进程独立的数据信息，统计信息等。绝大多数文件">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-08-02T10:14:00.104Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="系统状态统计和查看">
<meta name="twitter:description" content="统计和查看linux的系统状态/proc的意义及说明在linux中查看各种状态，其实质是查看内核中相关进程的数据结构中的项，通过工具将其格式化后输出出来。但是内核的数据是绝对不能随意查看或更改的，至少不能直接去修改。所以在linux上出现了伪文件系统/proc，这是内核中各属性或状态向外提供访问或修改的接口。 在/proc下，记录了内核自己的数据信息，各进程独立的数据信息，统计信息等。绝大多数文件">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yunjis.cn/2019/08/02/系统状态统计和查看/">





  <title>系统状态统计和查看 | 莫欺少年穷</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">莫欺少年穷</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">浮世万千，吾爱有三。日，月，卿。日为朝，月为暮，卿为朝朝暮暮</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-schedule">
          <a href="/schedule/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-calendar"></i> <br>
            
            日程表
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>
            
            站点地图
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br>
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yunjis.cn/2019/08/02/系统状态统计和查看/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jonson">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="莫欺少年穷">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">系统状态统计和查看</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-02T06:12:45-04:00">
                2019-08-02
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux基础/" itemprop="url" rel="index">
                    <span itemprop="name">linux基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="统计和查看linux的系统状态"><a href="#统计和查看linux的系统状态" class="headerlink" title="统计和查看linux的系统状态"></a>统计和查看linux的系统状态</h2><h3 id="proc的意义及说明"><a href="#proc的意义及说明" class="headerlink" title="/proc的意义及说明"></a>/proc的意义及说明</h3><p>在linux中查看各种状态，其实质是查看内核中相关进程的数据结构中的项，通过工具将其格式化后输出出来。但是内核的数据是绝对不能随意查看或更改的，至少不能直接去修改。所以在linux上出现了伪文件系统/proc，这是内核中各属性或状态向外提供访问或修改的接口。</p>
<p>在/proc下，记录了内核自己的数据信息，各进程独立的数据信息，统计信息等。绝大多数文件都是只读不可改的。即使对root也一样，但/proc/sys除外。</p>
<p>其中数字命名的目录对应的是各进程的pid号，其内的文件记录的都是该进程当前的数据信息，且都是只读的，例如记录命令信息的cmdline文件，进程使用哪颗cpu信息cpuset，进程占用内存的信息mem文件，进程IO信息io文件等其他各种信息文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# ls /proc/6982</span><br><span class="line">attr       clear_refs       cpuset   fd      loginuid   mounts      numa_maps      pagemap      schedstat  stat     task</span><br><span class="line">autogroup  cmdline          cwd      fdinfo  maps       mountstats  oom_adj        personality  sessionid  statm    wchan</span><br><span class="line">auxv       comm             environ  io      mem        net         oom_score      root         smaps      status</span><br><span class="line">cgroup     coredump_filter  exe      limits  mountinfo  ns          oom_score_adj  sched        stack      syscall</span><br></pre></td></tr></table></figure>

<p>非数字命名的目录各有用途，例如bus表示总线信息，driver表示驱动信息，fs表示文件系统特殊信息，net表示网络信息，tty表示跟物理终端有关的信息，最特殊的两个是/proc/self和/proc/sys。</p>
<p>先说/proc/self目录，它表示的是当前正在访问/proc目录的进程，因为/proc目录是内核数据向外记录的接口，所以当前访问/proc目录的进程表示的就是当前cpu正在执行的进程。如果执行cat /proc/self/cmdline，会发现其结果总是该命令本身，因为cat是手动敲入的命令，它是重要性进程，cpu会立即执行该命令。</p>
<p>再说/proc/sys这个目录，该目录是为管理员提供用来修改内核运行参数的，所以该目录中的文件对root都是可写的，例如管理数据包转发功能的/proc/sys/net/ipv4/ip_forward文件。使用sysctl命令修改内核运行参数，其本质也是修改/proc/sys目录中的文件。<br> 查看进程信息</p>
<h3 id="pstree命令"><a href="#pstree命令" class="headerlink" title="pstree命令"></a>pstree命令</h3><p>pstree命令将以树的形式显示进程信息，默认树的分支是收拢的，也不显示pid，要显示这些信息需要指定对应的选项。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pstree [-a] [-c] [-h] [-l] [-p] [pid]</span><br><span class="line"></span><br><span class="line">选项说明：</span><br><span class="line">-a：显示进程的命令行</span><br><span class="line">-c：展开分支</span><br><span class="line">-h：高亮当前正在运行的进程及其父进程</span><br><span class="line">-p：显示进程pid，此选项也将展开分支</span><br><span class="line">-l：允许显示长格式进程。默认在显示结果中超过132个字符时将截断后面的字符。</span><br></pre></td></tr></table></figure>

<h3 id="ps命令"><a href="#ps命令" class="headerlink" title="ps命令"></a>ps命令</h3><p>ps命令查看当前这一刻的进程信息，注意查看的是静态进程信息，要查看随时刷新的动态进程信息(如windows的进程管理器那样，每秒刷新一次)，使用top或htop命令。</p>
<p>这个命令的man文档及其复杂，它同时支持3种类型的选项：GUN/BSD/UNIX，不同类型的选项其展示的信息格式不一样。有些加了”-“的是SysV风格 的选项，不加”-“的是BSD选项，加不加”-“它们的意义是不一样的，例如ps aux 和ps -aux是不同的。</p>
<p>其实只需掌握少数几个选项即可，关键的是要了解ps显示出的进程信息中每一列代表什么属性。</p>
<p>对于BSD风格的选项，只需知道一个用法ps aux足以，选项”a”表示列出依赖于终端的进程，选项”x”表示列出不依赖于终端的进程，所以两者结合就表示列出所有进程，选项”u”表示展现的进程信息是以用户为导向的，不用管它什么是以用户为导向，用ps aux就没错。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@server2 ~]# ps aux | tail</span><br><span class="line">USER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root       1340  0.0  0.0  27176   588 ?        Ss   20:30   0:00 /usr/sbin/xinetd -stayalive -pidfile /var/run/xinetd.pid</span><br><span class="line">root       2266  0.0  0.1  93212  2140 ?        Ss   20:30   0:00 /usr/libexec/postfix/master -w</span><br><span class="line">postfix    2268  0.0  0.2  93384  3992 ?        S    20:30   0:00 qmgr -l -t unix -u</span><br><span class="line">postfix    2306  0.0  0.2  93316  3972 ?        S    20:31   0:00 pickup -l -t unix -u</span><br><span class="line">root       2307  0.0  0.2 145552  5528 ?        Ss   20:31   0:00 sshd: root@pts/0</span><br><span class="line">root       2309  0.0  0.0      0     0 ?        S&lt;   20:31   0:00 [kworker/3:1H]</span><br><span class="line">root       2310  0.0  0.1 116568  3184 pts/0    Ss   20:31   0:00 -bash</span><br><span class="line">root       2352  0.0  0.0      0     0 ?        S&lt;   20:31   0:00 [kworker/1:2H]</span><br><span class="line">root       2355  0.0  0.0 139492  1632 pts/0    R+   20:34   0:00 ps aux</span><br><span class="line">root       2356  0.0  0.0 107928   676 pts/0    R+   20:34   0:00 tail</span><br></pre></td></tr></table></figure>

<p>各列的意义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">%CPU：表示CPU占用百分比，注意，CPU的衡量方式是占用时间，所以百分比的计算方式是&quot;进程占用cpu时间/cpu总时间&quot;，而不是cpu工作强度的状态。</span><br><span class="line">%MEM：表示各进程所占物理内存百分比。</span><br><span class="line">VSZ：表示各进程占用的虚拟内存，也就是其在线性地址空间中实际占用的内存。单位为kb。</span><br><span class="line">RSS：表示各进程占用的实际物理内存。单位为Kb。</span><br><span class="line">TTY：表示属于哪个终端的进程，&quot;?&quot;表示不依赖于终端的进程。</span><br><span class="line">STAT：进程所处的状态。</span><br><span class="line">    D：不可中断睡眠</span><br><span class="line">    R：运行中或等待队列中的进程(running/runnable)</span><br><span class="line">    S：可中断睡眠</span><br><span class="line">    T：进程处于stopped状态</span><br><span class="line">    Z：僵尸进程</span><br><span class="line">    对于BSD风格的ps选项，进程的状态还会显示下面几个组合信息。</span><br><span class="line"></span><br><span class="line">    &lt;：高优先级进程</span><br><span class="line">    N：低优先级进程</span><br><span class="line">    L：该进程在内存中有被锁定的页</span><br><span class="line">    s：表示该进程是session leader，即进程组的首进程。例如管道左边的进程，shell脚本中的shell进程</span><br><span class="line">    l：表示该进程是一个线程</span><br><span class="line">    +：表示是前端进程。前端进程一般来说都是依赖于终端的</span><br><span class="line">START：表示进程是何时被创建的</span><br><span class="line">TIME：表示各进程占用的CPU时间</span><br><span class="line">COMMAND：表示进程的命令行。如果是内核线程，则使用方括号&quot;[]&quot;包围</span><br></pre></td></tr></table></figure>

<p>注意到了没，ps aux没有显示出ppid。</p>
<p>另外常用的ps选项是ps -elf。其中”-e”表示输出全部进程信息，”-f”和”-l”分别表示全格式输出和长格式输出。全格式会输出cmd的全部参数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@server2 ~]# ps -lf</span><br><span class="line">F S UID         PID   PPID  C PRI  NI ADDR SZ WCHAN  STIME TTY          TIME CMD</span><br><span class="line">4 S postfix    2306   2266  0  80   0 - 23329 ep_pol 20:31 ?        00:00:00 pickup -l -t unix -u</span><br><span class="line">4 S root       2307   1141  0  80   0 - 36388 poll_s 20:31 ?        00:00:00 sshd: root@pts/0</span><br><span class="line">1 S root       2309      2  0  60 -20 -     0 worker 20:31 ?        00:00:00 [kworker/3:1H]</span><br><span class="line">4 S root       2310   2307  0  80   0 - 29142 wait   20:31 pts/0    00:00:00 -bash</span><br><span class="line">1 S root       2433      2  0  60 -20 -     0 worker 21:21 ?        00:00:00 [kworker/1:1H]</span><br><span class="line">1 S root       2479      2  0  80   0 -     0 worker 21:25 ?        00:00:00 [kworker/1:0]</span><br><span class="line">1 S root       2503      2  0  60 -20 -     0 worker 21:28 ?        00:00:00 [kworker/1:2H]</span><br><span class="line">1 S root       2532      2  0  80   0 -     0 worker 21:30 ?        00:00:00 [kworker/1:1]</span><br><span class="line">0 R root       2539   2310  0  80   0 - 34873 -      21:33 pts/0    00:00:00 ps -elf</span><br><span class="line">0 S root       2540   2310  0  80   0 - 26982 pipe_w 21:33 pts/0    00:00:00 tail</span><br></pre></td></tr></table></figure>

<p>各列的意义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">F：程序的标志位。0表示该程序只有普通权限，4表示具有root超级管理员权限，1表示该进程被创建的时候只进行了fork，没有进行exec</span><br><span class="line">S：进程的状态位，注意ps选项加了&quot;-&quot;的是非BSD风格选项，不会有&quot;s&quot;&quot;&lt;&quot;&quot;N&quot;&quot;+&quot;等的状态标识位</span><br><span class="line">C：CPU的百分比，注意衡量方式是时间</span><br><span class="line">PRI：进程的优先级，值越小，优先级越高，越早被调度类选中运行</span><br><span class="line">NI：进程的NICE值，值为-20到19，影响优先级的方式是PRI(new)=PRI(old)+NI，所以NI为负数的时候，越小将导致进程优先级越高。</span><br><span class="line">    ：但要注意，NICE值只能影响非实时进程。</span><br><span class="line">ADDR：进程在物理内存中哪个地方。</span><br><span class="line">SZ：进程占用的实际物理内存</span><br><span class="line">WCHAN：若进程处于睡眠状态，将显示其对应内核线程的名称，若进程为R状态，则显示&quot;-&quot;</span><br></pre></td></tr></table></figure>

<h3 id="ps后grep问题"><a href="#ps后grep问题" class="headerlink" title="ps后grep问题"></a>ps后grep问题</h3><p>在ps后加上grep筛选目标进程时，总会发现grep自身进程也被显示出来。先解释下为何会如此。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# ps aux | grep &quot;crond&quot;</span><br><span class="line">root       1425  0.0  0.1 117332  1276 ?        Ss   Jun10   0:00 crond</span><br><span class="line">root       8275  0.0  0.0 103256   856 pts/2    S+   17:07   0:00 grep crond</span><br></pre></td></tr></table></figure>

<p>通过管道将ps结果传递给grep时，管道协调了ps和grep两进程间通信，但管道的本质是进程间数据传递。管道左边的输出数据放入内存，由管道右边的进程读取。假如划分的内存不足以完全存放输出数据，则管道左边的进程将一直等待，直到管道右边取出内存中一部分的数据以让管道左边的进程继续输出，而管道右边的进程在管道左边的进程启动后也立刻启动了(实际上，管道左右两边的进程没有启动的先后顺序，谁先启动完全看内核对这两个进程的调度顺序，换句话说，看人品)，但是它一直处于等待状态，等待接收管道传递来的数据（就像是平时执行命令时不给输入文件将会一直等待输入一样）。</p>
<p>也就是说，管道左右两端的进程是同时被创建的(不考虑父进程创建进程消耗的那点时间)，但数据传输是有先后顺序的，左边先传，右边后收，所以可能会造成交叉的情况，左边还没执行完，就捕获到了右边的进程信息。在此处体现在ps还没有统计完进程信息时，grep进程就已经被ps抓到了。</p>
<p>要将grep自身进程排除在结果之外，方法有二：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# ps aux | grep &quot;crond&quot; | grep -v &quot;grep&quot;   # 使用-v将grep自己筛选掉</span><br><span class="line">root       1425  0.0  0.1 117332  1276 ?        Ss   Jun10   0:00 crond   </span><br><span class="line"></span><br><span class="line">[root@xuexi ~]# ps aux | grep &quot;cron[d]&quot;</span><br><span class="line">root       1425  0.0  0.1 117332  1276 ?        Ss   Jun10   0:00 crond</span><br></pre></td></tr></table></figure>

<p>第二种方法能成功是因为grep进程被ps捕获时的结果是”grep cron[d]”，而使用cron[d]匹配时，它将只能匹配crond，所以”grep cron[d]”被筛选掉了。其实加上其他字符将更容易理解。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# ps aux | grep &quot;cron[dabc]&quot;</span><br><span class="line">root       1425  0.0  0.1 117332  1276 ?        Ss   Jun10   0:00 crond</span><br></pre></td></tr></table></figure>

<p>uptime命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# uptime</span><br><span class="line"> 08:38:11 up 22:35,  2 users,  load average: 0.00, 0.01, 0.05</span><br></pre></td></tr></table></figure>

<p>显示当前时间，已开机运行多少时间，当前有多少用户已登录系统，以及3个平均负载值。</p>
<p>所谓负载率(load)，即特定时间长度内，cpu运行队列中的平均进程数(包括线程)，一般平均每分钟每核的进程数小于3都认为正常，大于5时负载已经非常高。在UNIX系统中，运行队列包括cpu正在执行的进程和等待cpu的进程(即所谓的可运行runable)。在Linux系统中，还包括不可中断睡眠态(IO等待)的进程。运行队列中每出现一个进程，load就加1，进程每退出运行队列，Load就减1。如果是多核cpu，则还要除以核数。</p>
<p>详细信息见man uptime和<a href="https://en.wikipedia.org/wiki/Load_(computing)" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Load_(computing)</a></p>
<p>例如，单核cpu上的负载值为”1.73 0.60 7.98”时，表示：</p>
<p>最近1分钟：1.73表示平均可运行的进程数，这一分钟要一直不断地执行这1.73个进程。0.73个进程等待该核cpu。</p>
<p>最近5分钟：平均进程数还不足1，表示该核cpu在过去5分钟空闲了40%的时间。</p>
<p>最近15分钟：7.98表示平均可运行的进程数，这15分钟要一直不断地执行这7.98个进程。</p>
<p>结合前5分钟的结果，说明前15-前10分钟时间间隔内，该核cpu的负载非常高。</p>
<p>如果是多核cpu，则还要将结果除以核数。例如4核时，某个最近一分钟的负载值为3.73，则意味着有3.73个进程在运行队列中，这些进程可被调度至4核中的任何一个核上运行。最近1分钟的负载值为1.6，表示这一分钟内每核cpu都空闲(1-1.6/4)=60%的时间。<br>所以，load的理想值是正好等于CPU的核数，小于核数的时候表示cpu有空闲，超出核数的时候表示有进程在等待cpu，即系统资源不足。</p>
<h3 id="top、htop以及iftop命令"><a href="#top、htop以及iftop命令" class="headerlink" title="top、htop以及iftop命令"></a>top、htop以及iftop命令</h3><p>top命令查看动态进程状态，默认每5秒刷新一次。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">top选项说明：</span><br><span class="line"></span><br><span class="line">-d：指定top刷新的时间间隔，默认是5 秒</span><br><span class="line">-b：批处理模式，每次刷新分批显示</span><br><span class="line">-n：指定top刷新几次就退出，可以配合-b使用</span><br><span class="line">-p：指定监控的pid，指定方式为-pN1 -pN2 ...或-pN1, N2 [,...]</span><br><span class="line">-u：指定要监控的用户的进程，可以是uid也可以是user_name</span><br><span class="line">在top动态模式下，按下各种键可以进行不同操作。使用&quot;h&quot;或&quot;?&quot;可以查看相关键的说明。</span><br><span class="line"></span><br><span class="line">  1     ：(数字一)表示是否要在top的头部显示出多个cpu信息</span><br><span class="line">  H     ：表示是否要显示线程，默认不显示</span><br><span class="line">  c,S   ： c表示是否要展开进程的命令行，S表示显示的cpu时间是否是累积模式，cpu累积模式下已死去的子进程cpu时间会累积到父进程中</span><br><span class="line">  x,y   ：x高亮排序的列，y表示高亮running进程</span><br><span class="line">  u     ：仅显示指定用户的进程</span><br><span class="line">  n or #：设置要显示最大的进程数量</span><br><span class="line">  k     ：杀进程</span><br><span class="line">  q     ：退出top</span><br><span class="line">  P ：以CPU 的使用资源排序显示</span><br><span class="line">  M ：以Memory 的使用资源排序显示</span><br><span class="line">  N ：以PID 来排序</span><br></pre></td></tr></table></figure>

<p>以下是top的一次结果。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# top</span><br><span class="line">top - 17:43:44 up 1 day, 14:16,  2 users,  load average: 0.10, 0.06, 0.01</span><br><span class="line">Tasks: 156 total,   1 running, 155 sleeping,   0 stopped,   0 zombie</span><br><span class="line">Cpu0  :  0.0%us,  0.0%sy,  0.0%ni,100.0%id,  0.0%wa,  0.0%hi,  0.0%si,  0.0%st</span><br><span class="line">Cpu1  :  0.0%us,  0.0%sy,  0.0%ni, 99.7%id,  0.0%wa,  0.0%hi,  0.3%si,  0.0%st</span><br><span class="line">Cpu2  :  0.0%us,  0.0%sy,  0.0%ni,100.0%id,  0.0%wa,  0.0%hi,  0.0%si,  0.0%st</span><br><span class="line">Cpu3  :  0.3%us,  0.0%sy,  0.0%ni, 99.7%id,  0.0%wa,  0.0%hi,  0.0%si,  0.0%st</span><br><span class="line">Mem:   1004348k total,   417928k used,   586420k free,    52340k buffers</span><br><span class="line">Swap:  2047996k total,        0k used,  2047996k free,   243800k cached</span><br><span class="line"></span><br><span class="line">   PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND </span><br><span class="line">     1 root      20   0 19364 1444 1132 S  0.0  0.1   0:00.96 init  </span><br><span class="line">     2 root      20   0     0    0    0 S  0.0  0.0   0:00.00 kthreadd </span><br><span class="line">     3 root      RT   0     0    0    0 S  0.0  0.0   0:01.28 migration/0  </span><br><span class="line">     4 root      20   0     0    0    0 S  0.0  0.0   0:00.59 ksoftirqd/0 </span><br><span class="line">     5 root      RT   0     0    0    0 S  0.0  0.0   0:00.00 stopper/0</span><br></pre></td></tr></table></figure>

<p>第1行：和w命令的第一行一样，也和uptime命令的结果一样。此行各列分别表示”当前时间”、”已开机时长”、”当前在线用户”、”前1、5、15分钟平均负载率”。</p>
<p>第2行：分别表示总进程数、running状态的进程数、睡眠状态的进程数、停止状态进程数、僵尸进程数。</p>
<p>第3-6行：每颗cpu的状况。<br>     us = user mode</p>
<pre><code>sy = system mode

ni = low priority user mode (nice)(用户空间中低优先级进程的cpu占用百分比)

id = idle task

wa = I/O waiting

hi = servicing IRQs(不可中断睡眠，hard interruptible)

si = servicing soft IRQs(可中断睡眠，soft interruptible)

st = steal (time given to other DomU instances)(被偷走的cpu时间，一般被虚拟化软件偷走)</code></pre><p>第7-8行：从字面意思理解即可。</p>
<p>VIRT：虚拟内存总量</p>
<p>RES：实际内存总量</p>
<p>SHR：共享内存量</p>
<p>TIME：进程占用的cpu时间(若开启了时间累积模式，则此处显示的是累积时间)</p>
<p>top命令虽然非常强大，但是太老了。所以有了新生代的top命令htop。htop默认没有安装，需要手动安装。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi ~]# yum -y install htop</span><br></pre></td></tr></table></figure>

<p>iftop用于动态显示网络接口的数据流量。用法也很简单，按下h键即可获取帮助。</p>
<p>负载高、CPU空闲，说明当前正在执行的任务基本不消耗CPU资源，大量的负载进程都在IO等待中。</p>
<p>可以从ps的进程状态中获取哪些进程是正在运行或运行队列中的(状态为R)，哪些进程是在不可中断睡眠中的(状态为D)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@xuexi src]# ps -eTo stat,pid,ppid,comm --no-header |grep -E &quot;^(D|R)&quot;</span><br><span class="line">R+    11864   9624 ps</span><br></pre></td></tr></table></figure>

<h3 id="vmstat命令"><a href="#vmstat命令" class="headerlink" title="vmstat命令"></a>vmstat命令</h3><p>注意vmstat的第一次统计是自开机起的平均值信息，从第二次开始的统计才是指定刷新时间间隔内的资源利用信息，若不指定刷新时间间隔，则默认只显示一次统计信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vmstat [-d] [delay [ count]]</span><br><span class="line">vmstat [-f]</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">选项说明：</span><br><span class="line">-f：统计自开机起fork的次数。包括fork、clone、vfork的次数。但不包括exec次数。</span><br><span class="line">-d：显示磁盘统计信息。</span><br><span class="line">delay：刷新时间间隔，若不指定，则只统计一次信息就退出vmstat。</span><br><span class="line">count：总共要统计的次数。</span><br><span class="line">例如，只统计一次信息。</span><br><span class="line"></span><br><span class="line">[root@xuexi ~]# vmstat</span><br><span class="line">procs -----------memory---------- ---swap-- -----io---- --system-- -----cpu-----</span><br><span class="line"> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st</span><br><span class="line"> 0  0      0 583692  52684 244200    0    0     5     3    4    5  0  0 100  0  0</span><br><span class="line">其中各列的意义如下：</span><br><span class="line"></span><br><span class="line">Procs</span><br><span class="line"></span><br><span class="line">   r: 等待队列中的进程数</span><br><span class="line">   b: 不可中断睡眠的进程数</span><br><span class="line">Memory</span><br><span class="line"></span><br><span class="line">   swpd: 虚拟内存使用总量</span><br><span class="line">   free: 空闲内存量</span><br><span class="line">   buff: buffer占用的内存量(buffer用于缓冲)</span><br><span class="line">   cache: cache占用的内存量(cache用于缓存)</span><br><span class="line">Swap</span><br><span class="line"></span><br><span class="line">   si:从磁盘加载到swap分区的数据流量，单位为&quot;kb/s&quot;</span><br><span class="line">   so: 从swap分区写到磁盘的数据流量，单位为&quot;kb/s&quot;</span><br><span class="line">IO</span><br><span class="line"></span><br><span class="line">   bi: 从块设备接受到数据的速率，单位为blocks/s</span><br><span class="line">   bo: 发送数据到块设备的速率，单位为blocks/s</span><br><span class="line">System</span><br><span class="line"></span><br><span class="line">   in: 每秒中断数，包括时钟中断数量</span><br><span class="line">   cs: 每秒上下文切换次数</span><br><span class="line">CPU：统计的是cpu时间百分比，具体信息和top的cpu统计列一样</span><br><span class="line"></span><br><span class="line">   us: Time spent running non-kernel code. (user time, including nice time)</span><br><span class="line">   sy: Time spent running kernel code. (system time)</span><br><span class="line">   id: Time spent idle. Prior to Linux 2.5.41, this includes IO-wait time.</span><br><span class="line">   wa: Time spent waiting for IO. Prior to Linux 2.5.41, included in idle.</span><br><span class="line">   st: Time stolen from a virtual machine. Prior to Linux 2.6.11, unknown.</span><br><span class="line">还可以统计磁盘的IO信息。统计信息的结果很容易看懂，所以略过。</span><br></pre></td></tr></table></figure>

<h3 id="iostat命令"><a href="#iostat命令" class="headerlink" title="iostat命令"></a>iostat命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">iostat主要统计磁盘或分区的整体使用情况。也可以输出cpu信息，甚至是NFS网络文件系统的信息。同vmstat/sar一样，第一次统计的都是自系统开机起的平均统计信息。</span><br><span class="line"></span><br><span class="line">iostat [ -c ] [ -d ] [ -n -h ][ -k | -m ] [ -p [device][,...] ] [ interval [ count ] ]</span><br><span class="line"></span><br><span class="line">选项说明：</span><br><span class="line">-c：统计cpu信息</span><br><span class="line">-d：统计磁盘信息</span><br><span class="line">-n：统计NFS文件系统信息</span><br><span class="line">-h：使NFS统计信息更人类可读化</span><br><span class="line">-k：指定以kb/s为单位显示</span><br><span class="line">-m：指定以mb/s为单位显示</span><br><span class="line">-p：指定要统计的设备名称</span><br><span class="line">-y：指定不显示第一次统计信息，即不显示自开机起的统计信息。</span><br><span class="line">interval：刷新时间间隔</span><br><span class="line">count：总统计次数</span><br><span class="line">例如：</span><br><span class="line"></span><br><span class="line">[root@xuexi ~]# iostat</span><br><span class="line">Linux 2.6.32-504.el6.x86_64 (xuexi.longshuai.com)       06/11/2017      _x86_64_        (4 CPU)</span><br><span class="line"> </span><br><span class="line">avg-cpu:  %user   %nice %system %iowait  %steal   %idle</span><br><span class="line">           0.01    0.00    0.03    0.01    0.00   99.96</span><br><span class="line"></span><br><span class="line">Device:            tps   Blk_read/s   Blk_wrtn/s   Blk_read   Blk_wrtn</span><br><span class="line">sda               0.58        39.44        23.14    5557194    3259968</span><br><span class="line">sdb               0.00         0.03         0.00       4256          0</span><br><span class="line">各列的意义都很清晰，从字面即可理解。</span><br><span class="line"></span><br><span class="line">tps：每秒transfer速率(transfers per second),一次对物理设备的IO请求为一个transfer，但多个逻辑请求可能只组成一个transfer</span><br><span class="line">Blk_read/s：每秒读取的block数量</span><br><span class="line">Blk_wrtn/s：每秒写入的block总数</span><br><span class="line">Blk_read：读取的总block数量</span><br><span class="line">Blk_wrtn：写入的总block数量</span><br></pre></td></tr></table></figure>

<h3 id="free命令"><a href="#free命令" class="headerlink" title="free命令"></a>free命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">free用于查看内存使用情况。CentOS 6和CentOS 7上显示格式不太一样。</span><br><span class="line"></span><br><span class="line">free [options]</span><br><span class="line">选项说明：</span><br><span class="line">-h：人类可读方式显式单位</span><br><span class="line">-m：以MB为显示单位</span><br><span class="line">-w：将buffers和cache分开单独显示。只对CentOS 7上有效</span><br><span class="line">-s：动态查看内存信息时的刷新时间间隔</span><br><span class="line">-c：一共要刷新多少次退出free</span><br><span class="line">以下以CentOS 7上的free结果说明各列的意义。</span><br><span class="line"></span><br><span class="line">[root@server2 ~]# free -m</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           1824         131        1286           8         407        1511</span><br><span class="line">Swap:          1999           0        1999</span><br><span class="line">Mem和Swap分别表示物理内存和交换分区的使用情况。</span><br><span class="line"></span><br><span class="line">total：总内存空间</span><br><span class="line">used：已使用的内存空间。该值是total-free-buffers-cache的结果</span><br><span class="line">free：未使用的内存空间</span><br><span class="line">shared：/tmpfs总用的内存空间。对内核版本有要求，若版本不够，则显示为0。</span><br><span class="line">buff/cache：buffers和cache的总占用空间</span><br><span class="line">available：可用的内存空间。即程序启动时，将认为可用空间有这么多。可用的内存空间为free+buffers+cache。</span><br><span class="line">所以available才是真正需要关注的可使用内存空间量。</span><br><span class="line"></span><br><span class="line">使用-w可以将buffers/cache分开显示。</span><br><span class="line"></span><br><span class="line">[root@server2 ~]# free -w -m</span><br><span class="line">              total        used        free      shared     buffers       cache   available</span><br><span class="line">Mem:           1824         131        1286           8           0         406        1511</span><br><span class="line">Swap:          1999           0        1999</span><br><span class="line">还可以动态统计内存信息，例如每秒统计一次，统计2次。</span><br><span class="line"></span><br><span class="line">[root@server2 ~]# free -w -m -s 1 -c 2</span><br><span class="line">              total        used        free      shared     buffers       cache   available</span><br><span class="line">Mem:           1824         130        1287           8           0         406        1512</span><br><span class="line">Swap:          1999           0        1999</span><br><span class="line"></span><br><span class="line">              total        used        free      shared     buffers       cache   available</span><br><span class="line">Mem:           1824         130        1287           8           0         406        1512</span><br><span class="line">Swap:          1999           0        1999</span><br><span class="line">以下是CentOS 6上的free结果。</span><br><span class="line"></span><br><span class="line">[root@xuexi ~]# free -m</span><br><span class="line">             total       used       free     shared    buffers     cached</span><br><span class="line">Mem:           980        415        565          0         53        239</span><br><span class="line">-/+ buffers/cache:        121        859</span><br><span class="line">Swap:         1999          0       1999</span><br><span class="line">在此结果中，&quot;-/+ buffers/cache&quot;的free列才是真正可用的内存空间了，即CentOS 7上的available列。</span><br><span class="line"></span><br><span class="line">一般来说，内存可用量的范围低于20%应该要引起注意了。</span><br></pre></td></tr></table></figure>

<h3 id="sar命令"><a href="#sar命令" class="headerlink" title="sar命令"></a>sar命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line">sar是一个非常强大的性能分析工具，它可以获取系统的cpu/等待队列/磁盘IO/内存/网络等性能指标。</span><br><span class="line"></span><br><span class="line">功能多的必然结果是选项多，应用复杂，但只要知道一些常用的选项足以。</span><br><span class="line"></span><br><span class="line">sar [options] [-o filename] [delay [count] ]</span><br><span class="line">选项说明：</span><br><span class="line">-A：显示系统所有资源运行状况</span><br><span class="line">-b：显示磁盘IO和tranfer速率信息，和iostat的信息一样，是总体IO统计信息</span><br><span class="line">-d：显示磁盘在刷新时间间隔内的活跃情况，可以指定一个或多个设备，和-b不同的是，它显示的是单设备的IO、transfer信息。</span><br><span class="line">  ：建议配合-p使用显示友好的设备名，否则默认显示带主次设备号的设备名</span><br><span class="line">-P：显示指定的某颗或某几颗cpu的使用情况。指定方式为，-P 0,1,2,3或ALL。</span><br><span class="line">-u：显示每颗cpu整体平均使用情况。-u和-P的区别通过下面的示例很容易区分。</span><br><span class="line">-r：显示内存在刷新时间间隔内的使用情况</span><br><span class="line">-n：显示网络运行状态。后可接DEV/NFS/NFSD/ALL等多种参数。</span><br><span class="line">  ：DEV表示显示网路接口信息，NFS和NFSD分别表示显示NFS客户端服务端的流量信息，ALL表示显示所有信息。</span><br><span class="line">-q：显示等待队列大小</span><br><span class="line">-o filename：将结果存入到文件中</span><br><span class="line">delay：状态刷新时间间隔</span><br><span class="line">count：总共刷新几次</span><br><span class="line"></span><br><span class="line">10.5.1 统计cpu使用情况</span><br><span class="line">[root@server2 ~]# sar -P ALL 1 2</span><br><span class="line">Linux 3.10.0-327.el7.x86_64 (server2.longshuai.com)     06/20/2017      _x86_64_        (4 CPU)</span><br><span class="line"></span><br><span class="line">01:18:49 AM     CPU     %user     %nice   %system   %iowait    %steal     %idle</span><br><span class="line">01:18:50 AM     all      0.00      0.00      0.25      0.00      0.00     99.75</span><br><span class="line">01:18:50 AM       0      0.00      0.00      0.00      0.00      0.00    100.00</span><br><span class="line">01:18:50 AM       1      0.00      0.00      0.00      0.00      0.00    100.00</span><br><span class="line">01:18:50 AM       2      0.00      0.00      0.00      0.00      0.00    100.00</span><br><span class="line">01:18:50 AM       3      0.00      0.00      0.00      0.00      0.00    100.00</span><br><span class="line"> </span><br><span class="line">01:18:50 AM     CPU     %user     %nice   %system   %iowait    %steal     %idle</span><br><span class="line">01:18:51 AM     all      0.00      0.00      0.00      0.00      0.00    100.00</span><br><span class="line">01:18:51 AM       0      0.00      0.00      0.00      0.00      0.00    100.00</span><br><span class="line">01:18:51 AM       1      0.00      0.00      0.99      0.00      0.00     99.01</span><br><span class="line">01:18:51 AM       2      0.00      0.00      0.00      0.00      0.00    100.00</span><br><span class="line">01:18:51 AM       3      0.00      0.00      0.00      0.00      0.00    100.00</span><br><span class="line"> </span><br><span class="line">Average:        CPU     %user     %nice   %system   %iowait    %steal     %idle</span><br><span class="line">Average:        all      0.00      0.00      0.12      0.00      0.00     99.88</span><br><span class="line">Average:          0      0.00      0.00      0.00      0.00      0.00    100.00</span><br><span class="line">Average:          1      0.00      0.00      0.50      0.00      0.00     99.50</span><br><span class="line">Average:          2      0.00      0.00      0.00      0.00      0.00    100.00</span><br><span class="line">Average:          3      0.00      0.00      0.00      0.00      0.00    100.00</span><br><span class="line">各列的意义就不再赘述了，在前面几个信息查看命令已经解释过多次了。</span><br><span class="line"></span><br><span class="line">在上面的例子中，统计了所有cpu(0,1,2,3共4颗)每秒的状态信息，每秒还进行了一次汇总，即all，最后还对每颗cpu和汇总all计算了平均值。而我们真正需要关注的是最后的average部分的idle值，idle越小，说明cpu处于空闲时间越少，该颗或整体cpu使用率就越高。</span><br><span class="line"></span><br><span class="line">或者直接对整体进行统计。如下：</span><br><span class="line"></span><br><span class="line">[root@server2 ~]# sar -u 1 2</span><br><span class="line">Linux 3.10.0-327.el7.x86_64 (server2.longshuai.com)     06/20/2017      _x86_64_        (4 CPU)</span><br><span class="line"></span><br><span class="line">01:18:37 AM     CPU     %user     %nice   %system   %iowait    %steal     %idle</span><br><span class="line">01:18:39 AM     all      0.00      0.00      0.00      0.00      0.00    100.00</span><br><span class="line">01:18:40 AM     all      0.00      0.00      0.23      0.00      0.00     99.77</span><br><span class="line">Average:        all      0.00      0.00      0.12      0.00      0.00     99.88</span><br><span class="line"></span><br><span class="line">10.5.2 统计内存使用情况</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">其中kbdirty表示内存中脏页的大小，即内存中还有多少应该刷新到磁盘的数据。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">10.5.3 统计网络流量</span><br><span class="line">第一种方法是查看/proc/net/dev文件。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">关注列：receive和transmit分别表示收包和发包，关注每个网卡的bytes即可获得网卡的情况。写一个脚本计算每秒的差值即为网络流量。</span><br><span class="line"></span><br><span class="line">或者使用sar -n命令统计网卡接口的数据。</span><br><span class="line"></span><br><span class="line">[root@server2 ~]# sar -n DEV 1 2</span><br><span class="line">Linux 3.10.0-327.el7.x86_64 (server2.longshuai.com)     06/20/2017      _x86_64_        (4 CPU)</span><br><span class="line"></span><br><span class="line">01:51:11 AM     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s</span><br><span class="line">01:51:12 AM      eth0      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">01:51:12 AM        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line"></span><br><span class="line">01:51:12 AM     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s</span><br><span class="line">01:51:13 AM      eth0      0.99      0.99      0.06      0.41      0.00      0.00      0.00</span><br><span class="line">01:51:13 AM        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line"></span><br><span class="line">Average:        IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s</span><br><span class="line">Average:         eth0      0.50      0.50      0.03      0.21      0.00      0.00      0.00</span><br><span class="line">Average:           lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">各列的意义如下：</span><br><span class="line"></span><br><span class="line">rxpck/s：每秒收到的包数量</span><br><span class="line">txpck/s：每秒发送的包数量</span><br><span class="line">rxkB/s：每秒收到的数据，单位为kb</span><br><span class="line">txkB/s：每秒发送的数据，单位为kb</span><br><span class="line">rxcmp/s：每秒收到的压缩后的包数量</span><br><span class="line">txcmp/s：每秒发送的压缩后的包数量</span><br><span class="line">rxmcst/s：每秒收到的多播包数量</span><br><span class="line"></span><br><span class="line">10.5.4 查看队列情况</span><br><span class="line">[root@server2 ~]# sar -q</span><br><span class="line">Linux 3.10.0-327.el7.x86_64 (server2.longshuai.com)     06/20/2017      _x86_64_        (4 CPU)</span><br><span class="line"></span><br><span class="line">12:00:01 AM   runq-sz  plist-sz   ldavg-1   ldavg-5  ldavg-15   blocked</span><br><span class="line">12:10:01 AM         0       446      0.01      0.02      0.05         0</span><br><span class="line">12:20:01 AM         0       445      0.02      0.03      0.05         0</span><br><span class="line">12:30:01 AM         0       446      0.00      0.01      0.05         0</span><br><span class="line">Average:            0       446      0.01      0.02      0.05         0</span><br><span class="line">每列意义解释：</span><br><span class="line"></span><br><span class="line">runq-sz：等待队列的长度，不包括正在运行的进程</span><br><span class="line">plist-sz：任务列表中的进程数量，即总任务数</span><br><span class="line">ldavg-N：过去1分钟、5分钟、15分钟内系统的平均哎</span><br><span class="line">blocked：当前因为IO等待被阻塞的任务数量</span><br><span class="line"></span><br><span class="line">10.5.5 统计磁盘IO情况</span><br><span class="line">[root@server2 ~]# sar -d -p 1 2</span><br><span class="line">Linux 3.10.0-327.el7.x86_64 (server2.longshuai.com)     06/20/2017      _x86_64_        (4 CPU)</span><br><span class="line"> </span><br><span class="line">12:53:06 AM   DEV    tps  rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz   await   svctm   %util</span><br><span class="line">12:53:07 AM   sda   0.00      0.00      0.00      0.00      0.00    0.00    0.00    0.00</span><br><span class="line"> </span><br><span class="line">12:53:07 AM   DEV    tps  rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz   await   svctm   %util</span><br><span class="line">12:53:08 AM   sda   0.00      0.00      0.00      0.00      0.00    0.00    0.00    0.00</span><br><span class="line"></span><br><span class="line">Average:      DEV    tps  rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz   await   svctm   %util</span><br><span class="line">Average:      sda   0.00      0.00      0.00      0.00      0.00    0.00    0.00    0.00</span><br><span class="line">分别统计的是12:53:06到12:53:07和12:53:07到12:53:08这两秒的IO使用情况。</span><br><span class="line"></span><br><span class="line">各列的意义如下：</span><br><span class="line"></span><br><span class="line">tps：transfer per second，每秒的transfer速率，一次物理IO请求算一次transfer，但多次逻辑IO请求可能组合起来才算一次transfer。</span><br><span class="line">rd_sec/s：每秒读取的扇区数，扇区大小为512字节。</span><br><span class="line">wr_sec/s：每秒写入的扇区数。</span><br><span class="line">avgrq-sz：请求写入设备的平均大小，单位为扇区。(The average size (in sectors) of the requests that were issued to the device)</span><br><span class="line">avgqu-sz：请求写入设备的平均队列长度。(The average queue length of the requests that were issued to the device.)</span><br><span class="line">await：写入设备的IO请求的平均(消耗)时间，单位微秒(The average time for I/O requests issued to the device to be served.)</span><br><span class="line">svctm：不可信的列，该列未来将被移除，所以不用管</span><br><span class="line">%util：最重要的一列，显示的是设备的带宽情况。该列若接近100%，说明磁盘速率饱和了。</span><br></pre></td></tr></table></figure>


      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/linux基础/" rel="tag"># linux基础</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/07/31/进程与信号分析/" rel="next" title="进程与信号分析">
                <i class="fa fa-chevron-left"></i> 进程与信号分析
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/08/07/nginx之proxy_pass详解/" rel="prev" title="nginx之proxy_pass详解">
                nginx之proxy_pass详解 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="jonson">
            
              <p class="site-author-name" itemprop="name">jonson</p>
              <p class="site-description motion-element" itemprop="description">运维</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">57</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#统计和查看linux的系统状态"><span class="nav-number">1.</span> <span class="nav-text">统计和查看linux的系统状态</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#proc的意义及说明"><span class="nav-number">1.1.</span> <span class="nav-text">/proc的意义及说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pstree命令"><span class="nav-number">1.2.</span> <span class="nav-text">pstree命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ps命令"><span class="nav-number">1.3.</span> <span class="nav-text">ps命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ps后grep问题"><span class="nav-number">1.4.</span> <span class="nav-text">ps后grep问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#top、htop以及iftop命令"><span class="nav-number">1.5.</span> <span class="nav-text">top、htop以及iftop命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vmstat命令"><span class="nav-number">1.6.</span> <span class="nav-text">vmstat命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#iostat命令"><span class="nav-number">1.7.</span> <span class="nav-text">iostat命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#free命令"><span class="nav-number">1.8.</span> <span class="nav-text">free命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sar命令"><span class="nav-number">1.9.</span> <span class="nav-text">sar命令</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>
<div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jonson</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v="></script>

  <script type="text/javascript" src="/js/src/motion.js?v="></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v="></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v="></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v="></script>
<script type="text/javascript" src="/js/src/post-details.js?v="></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v="></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false,"tagMode":false});</script></body>
</html>
